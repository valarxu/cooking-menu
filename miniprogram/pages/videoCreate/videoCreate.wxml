<view class="video-create-container">
  <!-- æ­¥éª¤ä¸€ï¼šæ–‡æ¡ˆè¾“å…¥ -->
  <view wx:if="{{step === 1}}">
    <textarea class="text-input" placeholder="è¯·è¾“å…¥æ–‡æ¡ˆ æˆ– ç”¨AIç”Ÿæˆ" value="{{text}}" bindinput="onTextInput" maxlength="{{-1}}"></textarea>
    <view class="btn-container">
      <my-button wx:if="{{!text}}" type="primary" type="outline" bindtap="onAIGenerate">ç”¨AIç”Ÿæˆ</my-button>
      <my-button type="primary" bindtap="nextStep">ä¸‹ä¸€æ­¥</my-button>
    </view>
  </view>

  <!-- æ­¥éª¤äºŒï¼šå£°éŸ³é€‰æ‹© -->
  <view wx:if="{{step === 2}}">
    <view class="step-title">é€‰æ‹©å£°éŸ³</view>
    
    <!-- å£°éŸ³åˆ—è¡¨ -->
    <view class="voice-list">
      <view class="voice-items">
        <view class="voice-item {{selectedVoiceId === item.id ? 'selected' : ''}} {{item.isCloned ? 'cloned-voice' : ''}}" wx:for="{{voiceList}}" wx:key="id" data-voice-id="{{item.id}}" bindtap="selectVoice">
          <view class="voice-info">
            <image class="voice-avatar" src="{{item.avatar}}" mode="aspectFill"></image>
            <view class="voice-details">
              <view class="voice-name-wrapper">
                <text class="voice-name">{{item.name}}</text>
                <text class="cloned-badge" wx:if="{{item.isCloned}}">æˆ‘çš„</text>
              </view>
              <text class="voice-desc">{{item.description}}</text>
            </view>
          </view>
          <view class="voice-actions">
            <button class="play-btn {{playingVoiceId === item.id ? 'playing' : ''}}" data-voice-id="{{item.id}}" data-audio-url="{{item.sampleUrl}}" catchtap="playVoiceSample" size="mini">
              {{playingVoiceId === item.id ? 'æš‚åœ' : 'è¯•å¬'}}
            </button>
          </view>
        </view>
        
        <!-- ä¸Šä¼ é…éŸ³é€‰é¡¹ -->
        <view class="voice-item {{selectedVoiceId === 'upload' ? 'selected' : ''}}" data-voice-id="upload" bindtap="selectVoice">
          <view class="voice-info">
            <image class="voice-avatar" src="/images/avatar/male1.svg" mode="aspectFill"></image>
            <view class="voice-details">
              <view class="voice-name-wrapper">
                <text class="voice-name">ä¸Šä¼ é…éŸ³</text>
              </view>
              <text class="voice-desc">{{uploadedVoiceFile ? uploadedVoiceFile.name || 'å·²é€‰æ‹©éŸ³é¢‘æ–‡ä»¶' : 'ä¸Šä¼ æ‚¨è‡ªå·±çš„é…éŸ³æ–‡ä»¶'}}</text>
            </view>
          </view>
          <view class="voice-actions">
            <button class="upload-btn" bindtap="uploadVoiceFile" size="mini">
              {{uploadedVoiceFile ? 'é‡æ–°é€‰æ‹©' : 'é€‰æ‹©æ–‡ä»¶'}}
            </button>
          </view>
        </view>
      </view>
    </view>
    
    <view class="btn-container">
      <my-button type="outline" bindtap="prevStep">ä¸Šä¸€æ­¥</my-button>
      <my-button type="primary" bindtap="nextStep">ä¸‹ä¸€æ­¥</my-button>
    </view>
  </view>

  <!-- æ­¥éª¤ä¸‰ï¼šBGMé€‰æ‹© -->
  <view wx:if="{{step === 3}}">
    <view class="step-title">é€‰æ‹©BGM</view>
    
    <view class="bgm-options">
      <radio-group bindchange="onBgmTypeChange">
        <label class="bgm-option {{bgmType === 'auto' ? 'selected' : ''}}">
          <radio value="auto" checked="{{bgmType==='auto'}}" />è‡ªåŠ¨é€‰æ‹©
          <view class="option-desc">ç³»ç»Ÿå°†æ ¹æ®æ–‡æ¡ˆå†…å®¹è‡ªåŠ¨åŒ¹é…åˆé€‚çš„èƒŒæ™¯éŸ³ä¹</view>
        </label>
        <label class="bgm-option {{bgmType === 'upload' ? 'selected' : ''}}">
          <radio value="upload" checked="{{bgmType==='upload'}}" />è‡ªå·±ä¸Šä¼ 
          <view class="option-desc">{{uploadedBgmFile ? uploadedBgmFile.name || 'å·²é€‰æ‹©BGMæ–‡ä»¶' : 'ä¸Šä¼ æ‚¨è‡ªå·±çš„èƒŒæ™¯éŸ³ä¹'}}</view>
        </label>
      </radio-group>
    </view>
    
    <view class="btn-container">
      <view wx:if="{{bgmType==='upload'}}">
        <my-button type="primary" bindtap="uploadBgmFile">{{uploadedBgmFile ? 'é‡æ–°é€‰æ‹©BGM' : 'é€‰æ‹©BGMæ–‡ä»¶'}}</my-button>
      </view>
      <my-button type="outline" bindtap="prevStep">ä¸Šä¸€æ­¥</my-button>
      <my-button type="primary" bindtap="nextStep">ä¸‹ä¸€æ­¥</my-button>
    </view>
  </view>

  <!-- æ­¥éª¤å››ï¼šè§†é¢‘ç´ æé€‰æ‹© -->
  <view wx:if="{{step === 4}}">
    <view class="step-title">é€‰æ‹©è§†é¢‘ç´ æ</view>
    <view class="step-desc">è¯·é€‰æ‹©è§†é¢‘ç´ æï¼ˆå¯å¤šé€‰ï¼‰ï¼š</view>
    <checkbox-group value="{{selectedMaterialIds}}" bindchange="onMaterialCheckboxChange">
      <view class="video-list">
        <block wx:if="{{materialList.length > 0}}">
          <view class="video-item" wx:for="{{materialList}}" wx:key="_id">
            <view style="position:relative;">
              <video class="video-player" src="{{item.fileID}}" show-center-play-btn="{{true}}" controls></video>
              <checkbox class="material-checkbox" value="{{item._id}}" style="position:absolute;top:8rpx;right:8rpx;z-index:2;" />
            </view>
            <view class="video-info">
              <text class="video-name">{{item.name}}</text>
              <text class="upload-time">{{item.uploadTime}}</text>
            </view>
          </view>
        </block>
        <view class="empty-tip" wx:else>
          <text>æš‚æ— è§†é¢‘ç´ æ</text>
        </view>
      </view>
    </checkbox-group>
    <view class="btn-container">
      <my-button type="outline" bindtap="prevStep">ä¸Šä¸€æ­¥</my-button>
      <my-button type="primary" bindtap="onGenerateVideo" disabled="{{isGenerating}}">{{isGenerating ? 'ç”Ÿæˆä¸­...' : 'ç”Ÿæˆè§†é¢‘'}}</my-button>
    </view>
    
    <!-- ä»»åŠ¡çŠ¶æ€æ˜¾ç¤ºåŒºåŸŸ -->
     <view class="task-status-section" wx:if="{{videoTasks.length > 0}}">
       <view class="section-header">
         <text class="section-title">è§†é¢‘ç”Ÿæˆä»»åŠ¡</text>
         <button class="refresh-btn" bindtap="refreshTaskStatus" size="mini">åˆ·æ–°çŠ¶æ€</button>
       </view>
       
       <view class="task-list">
         <view class="task-item" wx:for="{{videoTasks}}" wx:key="_id">
           <view class="task-header">
             <text class="task-time">{{item.created_at}}</text>
             <view class="task-status-wrapper">
               <text class="task-status {{item.status}}">{{item.status === 'completed' ? 'å·²å®Œæˆ' : item.status === 'processing' ? 'ç”Ÿæˆä¸­' : 'è¿›è¡Œä¸­'}}</text>
               <text class="task-progress" wx:if="{{item.status === 'processing'}}">{{item.completed_tasks || 0}}/{{item.total_tasks || 0}}</text>
             </view>
           </view>
           
           <!-- è¿›åº¦æ¡ -->
           <view class="progress-bar" wx:if="{{item.status === 'processing'}}">
             <view class="progress-fill" style="width: {{item.progress || 0}}"></view>
           </view>
           
           <view class="audio-results">
             <view class="audio-item" wx:for="{{item.audio_results}}" wx:for-item="audio" wx:key="taskId">
               <view class="audio-info">
                 <text class="audio-type">{{audio.type}}</text>
                 <text class="audio-text">{{audio.text}}</text>
               </view>
               <view class="audio-status">
                 <text class="status-text {{audio.status}}">
                   {{audio.status === 'completed' ? 'âœ“' : audio.status === 'pending' ? 'â³' : audio.status === 'processing' ? 'ğŸ”„' : 'âœ—'}}
                 </text>
                 <button wx:if="{{audio.audioUrl}}" class="play-audio-btn" data-url="{{audio.audioUrl}}" bindtap="playGeneratedAudio" size="mini">æ’­æ”¾</button>
               </view>
             </view>
           </view>
         </view>
       </view>
     </view>
  </view>
</view>