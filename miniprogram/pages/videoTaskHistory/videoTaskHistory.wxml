<view class="container">
  <!-- åˆ—è¡¨é¡µé¢ -->
  <view class="list-page" wx:if="{{!showDetail}}">
    
    <view class="content {{videoTasks.length === 0 ? 'empty' : ''}}">
      <!-- ä»»åŠ¡åˆ—è¡¨ -->
      <view class="task-status-section" wx:if="{{videoTasks.length > 0}}">
        <view class="section-header">
          <text class="section-title">è§†é¢‘ç”Ÿæˆä»»åŠ¡åˆ—è¡¨</text>
          <view class="refresh-btn" bindtap="refreshTaskStatus" size="mini">åˆ·æ–°</view>
        </view>
        
        <view class="task-list">
          <view class="task-item-simple" wx:for="{{videoTasks}}" wx:key="_id" bindtap="showTaskDetail" data-task="{{item}}">
            <view class="task-header">
              <text class="task-time">{{item.created_at}}</text>
              <view class="task-status-wrapper">
                <text class="task-status {{item.status}}">{{item.status === 'completed' ? 'å·²å®Œæˆ' : item.status === 'processing' ? 'ç”Ÿæˆä¸­' : 'è¿›è¡Œä¸­'}}</text>
              </view>
            </view>
            
            <!-- ç®€åŒ–çš„ä»»åŠ¡ä¿¡æ¯ -->
            <view class="task-summary">
              <text class="task-count">å…± {{item.total_tasks}} ä¸ªåˆ†é•œ</text>
              <text class="task-arrow">></text>
            </view>
          </view>
        </view>
      </view>
      
      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-state" wx:else>
        <image src="/images/empty-product.png" class="empty-icon" mode="aspectFit"></image>
        <view class="empty-text">æš‚æ— ç”Ÿæˆè®°å½•</view>
        <view class="empty-desc">æ‚¨è¿˜æ²¡æœ‰åˆ›å»ºè¿‡è§†é¢‘ç”Ÿæˆä»»åŠ¡</view>
      </view>
    </view>
  </view>

  <!-- è¯¦æƒ…é¡µé¢ -->
  <view class="detail-page" wx:if="{{showDetail}}">
    <view class="detail-header">
      <view class="back-btn" bindtap="backToList">
        <text class="back-icon">â€¹</text>
        <text class="back-text">è¿”å›</text>
      </view>
      <text class="detail-title">ä»»åŠ¡è¯¦æƒ…</text>
      <view class="detail-status">
        <text class="task-status {{currentTask.status}}">{{currentTask.status === 'completed' ? 'å·²å®Œæˆ' : currentTask.status === 'processing' ? 'ç”Ÿæˆä¸­' : 'è¿›è¡Œä¸­'}}</text>
      </view>
    </view>

    <!-- è§†é¢‘æ’­æ”¾åŒºåŸŸ -->
    <view class="video-player-section">
      <view class="video-container">
        <video 
          wx:if="{{currentSegment.finalVideoUrl || currentSegment.videoUrl}}"
          class="main-video" 
          src="{{currentSegment.finalVideoUrl || currentSegment.videoUrl}}"
          controls
          show-center-play-btn
          show-play-btn
          autoplay="{{false}}"
        ></video>
        <view wx:else class="video-placeholder">
          <text class="placeholder-text">{{currentSegment.status === 'completed' ? 'è§†é¢‘ç”Ÿæˆä¸­...' : 'ç­‰å¾…ç”Ÿæˆ'}}</text>
        </view>
      </view>
      
      <!-- å½“å‰åˆ†é•œä¿¡æ¯ -->
      <view class="current-segment-info">
        <view class="segment-type">{{currentSegment.type}}</view>
        <view class="segment-text">{{currentSegment.text}}</view>
      </view>
    </view>

    <!-- åˆ†é•œåˆ‡æ¢åŒºåŸŸ -->
    <view class="segments-section">
      <view class="segments-title">åˆ†é•œåˆ—è¡¨</view>
      <scroll-view class="segments-scroll" scroll-x>
        <view class="segments-list">
          <view 
            class="segment-item {{currentSegmentIndex === index ? 'active' : ''}}"
            wx:for="{{currentTask.audio_results}}"
            wx:for-item="segment"
            wx:for-index="index"
            wx:key="taskId"
            bindtap="switchSegment"
            data-index="{{index}}"
          >
            <view class="segment-preview">
              <view class="segment-thumbnail">
                <image 
                  wx:if="{{segment.finalVideoUrl || segment.videoUrl}}"
                  class="thumbnail-image" 
                  src="{{segment.finalVideoUrl || segment.videoUrl}}"
                  mode="aspectFill"
                ></image>
                <view wx:else class="thumbnail-placeholder">
                  <text class="thumbnail-icon">ğŸ“¹</text>
                </view>
              </view>
              <view class="segment-status-indicator">
                <text class="status-dot {{segment.status}}"></text>
              </view>
            </view>
            <view class="segment-info">
              <text class="segment-type-small">{{segment.type}}</text>
              <text class="segment-text-small">{{segment.text}}</text>
            </view>
          </view>
        </view>
      </scroll-view>
    </view>
  </view>
</view>